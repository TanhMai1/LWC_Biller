<template>
    <div class="dashboard-container">
        <!-- Header with Search - ALWAYS SHOW -->
        <div class="slds-page-header">
            <div class="slds-page-header__row">
                <div class="slds-page-header__col-title">
                    <div class="slds-media">
                        <div class="slds-media__figure">
                            <lightning-icon icon-name="custom:custom85" size="medium"></lightning-icon>
                        </div>
                        <div class="slds-media__body">
                            <h1 class="slds-page-header__title slds-truncate" title={dashboardTitle}>
                                {dashboardTitle}
                            </h1>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Search Bar - MOVED OUTSIDE OF lwc:if -->
            <div class="slds-page-header__row slds-m-top_small">
                <div class="slds-col slds-size_1-of-1">
                    <c-bg-search onrecordselect={handleRecordSelect}></c-bg-search>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="slds-grid slds-gutters">
            <!-- Left Content Area -->
            <div class={mainContentClass}>
                <!-- Loading State -->
                <template lwc:if={isLoading}>
                    <div class="slds-align_absolute-center slds-m-top_large">
                        <lightning-spinner alternative-text="Loading" size="medium"></lightning-spinner>
                    </div>
                </template>

                <!-- Dashboard Content -->
                <template lwc:if={showDashboard}>
                    <!-- Partner Dashboard -->
                    <template lwc:if={isPartnerMode}>
                        <c-bg-partner-account-page 
                            account-id={currentRecordId}
                            onopennotes={handleOpenNotes}>
                        </c-bg-partner-account-page>
                    </template>

                    <!-- Merchant Dashboard -->
                    <template lwc:if={isMerchantMode}>
                        <c-bg-merchant-account-page 
                            account-id={currentRecordId}
                            onopennotes={handleOpenNotes}>
                        </c-bg-merchant-account-page>
                    </template>

                    <!-- Reseller Contact Dashboard -->
                    <template lwc:if={isResellerContactMode}>
                        <c-bg-reseller-contact-page 
                            contact-id={currentRecordId}
                            onopennotes={handleOpenNotes}>
                        </c-bg-reseller-contact-page>
                    </template>
                </template>

                <!-- Welcome Message (when no dashboard is selected) -->
                <template lwc:if={showWelcome}>
                    <div class="slds-align_absolute-center slds-m-top_large">
                        <div class="slds-text-align_center">
                            <lightning-icon icon-name="utility:search" size="large" class="slds-m-bottom_small"></lightning-icon>
                            <h2 class="slds-text-heading_medium">Search for a record to get started</h2>
                            <p class="slds-text-body_regular slds-m-top_small">
                                Search for Resellers, Merchants, or Contacts using the search bar above
                            </p>
                        </div>
                    </div>
                </template>
            </div>

            <!-- Notes Sidebar (Right) -->
            <template lwc:if={isNotesSidebarOpen}>
                <div class="slds-col slds-size_3-of-12 notes-sidebar">
                    <c-bg-notes 
                        parent-id={currentRecordId}
                        onclosesidebar={handleCloseNotes}>
                    </c-bg-notes>
                </div>
            </template>
        </div>
    </div>
</template>